<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Art Studio Pro - Cloud Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: #e5e7eb; font-family: 'Inter', sans-serif; }
        .btn-opt { background: #1a1a1a; border: 1px solid #333; transition: all 0.2s; cursor: pointer; font-size: 0.75rem; position: relative; }
        .btn-opt.active { background: #4f46e5; border-color: #818cf8; color: white; }
        .btn-opt.weighted::after { content: '1.3'; position: absolute; top: -5px; right: -5px; background: #fbbf24; color: black; font-size: 0.6rem; padding: 1px 3px; border-radius: 4px; font-weight: bold; }
        .section-card { background: #111; border-radius: 12px; padding: 1rem; border: 1px solid #222; margin-bottom: 1rem; }
        .sticky-header { position: sticky; top: 0; z-index: 100; background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(10px); padding: 1rem 0; border-bottom: 1px solid #333; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-6xl mx-auto">
        <div class="sticky-header">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="bg-gray-900 p-4 rounded-xl border border-indigo-500/50">
                    <div class="flex justify-between items-center mb-2">
                        <select id="modelSelect" onchange="updatePrompt()" class="bg-gray-800 text-[10px] p-1 rounded border border-gray-600 outline-none text-indigo-300">
                            <option value="pony">MODELO: Pony Diffusion V6 (Recomendado)</option>
                            <option value="xl">MODELO: Illustration XL (SDXL)</option>
                            <option value="sd15">MODELO: Standard SD 1.5</option>
                        </select>
                        <div class="flex gap-2">
                            <button onclick="saveToFavorites()" class="text-[10px] bg-green-700 hover:bg-green-600 px-2 py-1 rounded transition">‚≠ê SALVAR NUVEM</button>
                            <button onclick="randomize()" class="text-[10px] bg-indigo-600 px-2 py-1 rounded">üé≤ RANDOM</button>
                            <button onclick="clearAll()" class="text-[10px] bg-red-900 px-2 py-1 rounded">LIMPAR</button>
                        </div>
                    </div>
                    <textarea id="output" class="w-full bg-black/40 text-xs h-24 p-2 border border-gray-800 rounded mb-2 font-mono" readonly></textarea>
                    <button onclick="copy('output')" class="w-full bg-indigo-600 hover:bg-indigo-500 text-[10px] font-bold py-2 rounded uppercase">Copiar Positivo</button>
                </div>

                <div class="bg-gray-900 p-4 rounded-xl border border-red-900/30">
                    <span class="text-[10px] font-bold text-red-500 block mb-1 uppercase tracking-tighter">Negative Prompt (Auto-ajustado)</span>
                    <textarea id="negativeOutput" class="w-full bg-black/40 text-xs h-24 p-2 border border-gray-800 rounded mb-2 text-gray-500 font-mono" readonly></textarea>
                    <button onclick="copy('negativeOutput')" class="w-full bg-red-900/50 hover:bg-red-800 text-[10px] font-bold py-2 rounded uppercase">Copiar Negativo</button>
                </div>
            </div>
            
            <div class="mt-4 bg-gray-900 p-3 rounded-xl border border-yellow-600/20 shadow-inner">
                <span class="text-[10px] font-bold text-yellow-500 block mb-2 uppercase">‚òÅÔ∏è Favoritos no Google Cloud</span>
                <div id="favoritesList" class="flex flex-wrap gap-2 max-h-24 overflow-y-auto"></div>
            </div>
        </div>

        <div id="builder" class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>

    <script type="module">
        // --- FIREBASE CONFIG ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDDCA-De2_NIF5TWvMBOOLRRH2uvTN46Es",
            authDomain: "meugeradordeprompts.firebaseapp.com",
            projectId: "meugeradordeprompts",
            storageBucket: "meugeradordeprompts.firebasestorage.app",
            messagingSenderId: "301051793324",
            appId: "1:301051793324:web:1bbbd148b7e848e1397409"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const favsCollection = collection(db, "prompts");

        // --- DADOS DO GERADOR ---
        const categories = {
            "üë§ Tipo F√≠sico": ["1man", "muscular hunk", "twink", "bear", "hairy daddy", "athletic build", "ottermale", "buff bodybuilder", "hairy chest", "smooth skin", "thick thighs", "bearded", "silver fox", "massive biceps", "defined v-line", "heavy glutes", "veiny arms"],
            
            "üçÜ Sexo & Posi√ß√µes": ["2men", "gay couple", "passionate intercourse", "missionary position", "doggy style", "cowboy position", "reverse cowboy", "oral sex", "rimming", "anal focus", "deep kiss", "spanking", "spooning", "all fours", "handjob", "frottage", "double penetration"],
            
            "‚õìÔ∏è Fetiche & Materiais": ["jockstrap", "leather harness", "latex gear", "shiny pvc", "rubber suit", "bondage gear", "bulge focus", "visible erection", "shirtless", "nude", "half-undressed", "leather mask", "cockring", "ball gag", "sweaty skin", "dripping sweat", "oiled body"],
            
            "üëî Roupas & Uniformes": ["suit and tie", "unbuttoned shirt", "grey sweatpants", "soccer kit", "police uniform", "military gear", "white briefs", "satin boxers", "towel", "crop top", "thong", "combat boots", "sneakers and socks", "silk robe", "tracksuit"],
            
            "üìç Ambientes": ["dark alley", "steamy shower", "luxury penthouse", "gym locker room", "leather bar", "neon street", "warehouse", "bedroom", "sauna", "dungeon", "public park night", "prison cell", "garage", "backstage", "hotel room"],
            
            "üé® Estilo Art√≠stico": ["digital illustration", "cel shaded", "flat color", "thick lines", "anime style", "high contrast", "comic book art", "concept art", "oil painting", "detailed shadows", "vibrant colors", "masterpiece style"]
        };

        let selectedTags = {}; 
        let categoryWeights = {};

        // Injetar fun√ß√µes no escopo global para os bot√µes HTML funcionarem com Type="module"
        window.saveToFavorites = async function() {
            const p = document.getElementById('output').value;
            if(!p) return;
            try { await addDoc(favsCollection, { text: p, createdAt: new Date() }); } 
            catch (e) { alert("Erro ao salvar! Verifique as regras do Firebase."); }
        };

        window.deleteFromGoogle = async (id) => { if(confirm("Excluir?")) await deleteDoc(doc(db, "prompts", id)); };

        window.toggleTag = (tag) => { selectedTags[tag] = !selectedTags[tag]; updatePrompt(); render(); };

        window.toggleCategoryWeight = (cat) => { categoryWeights[cat] = !categoryWeights[cat]; updatePrompt(); render(); };

        window.clearAll = () => { selectedTags = {}; categoryWeights = {}; updatePrompt(); render(); };

        window.copy = (id) => { const a = document.getElementById(id); a.select(); document.execCommand('copy'); alert("Copiado!"); };

        window.randomize = () => {
            selectedTags = {}; categoryWeights = {};
            Object.entries(categories).forEach(([cat, opts]) => {
                if(Math.random() > 0.4) {
                    const r = opts[Math.floor(Math.random() * opts.length)];
                    selectedTags[r] = true;
                    if(Math.random() > 0.7) categoryWeights[cat] = true;
                }
            });
            updatePrompt(); render();
        };

        function render() {
            const container = document.getElementById('builder');
            container.innerHTML = '';
            for (const [cat, options] of Object.entries(categories)) {
                const section = document.createElement('div');
                section.className = "section-card";
                section.innerHTML = `
                    <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
                        <h3 class="text-[10px] font-bold text-indigo-400 uppercase">${cat}</h3>
                        <button onclick="toggleCategoryWeight('${cat}')" class="text-[9px] ${categoryWeights[cat] ? 'bg-yellow-600 text-black' : 'bg-gray-800 text-gray-400'} px-2 py-0.5 rounded font-bold transition">PESO +</button>
                    </div>
                `;
                const grid = document.createElement('div');
                grid.className = "grid grid-cols-2 gap-2";
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.innerText = opt;
                    const isSelected = selectedTags[opt];
                    btn.className = `btn-opt p-2 rounded-md text-left ${isSelected ? 'active' : ''} ${isSelected && categoryWeights[cat] ? 'weighted' : ''}`;
                    btn.onclick = () => toggleTag(opt);
                    grid.appendChild(btn);
                });
                section.appendChild(grid);
                container.appendChild(section);
            }
        }

        function updatePrompt() {
            const model = document.getElementById('modelSelect').value;
            let tags = [];
            
            // Auto-corre√ß√£o de quantidade
            if(selectedTags["2men"] || selectedTags["gay couple"]) delete selectedTags["1man"];

            for(const [cat, opts] of Object.entries(categories)) {
                opts.forEach(opt => {
                    if(selectedTags[opt]) tags.push(categoryWeights[cat] ? `(${opt}:1.3)` : opt);
                });
            }

            let pos = ""; let neg = "";

            if (model === "pony") {
                pos = `score_9, score_8, score_7, rating_explicit, source_anime, ${tags.join(", ")}`;
                neg = "score_4, score_5, score_6, low quality, bad anatomy, text, signature, 3d, realistic, female, woman, girl, blurred, missing limbs, extra fingers, distorted genitals, flat chest, huge eyes";
            } else {
                pos = `masterpiece, high quality, ${tags.join(", ")}, illustration, male focus`;
                neg = "female, woman, girl, lowres, bad anatomy, error, extra limbs, photo, realistic, blurred, crop, ugly";
            }

            document.getElementById('output').value = pos;
            document.getElementById('negativeOutput').value = neg;
        }

        // Snapshot Favoritos
        const q = query(favsCollection, orderBy("createdAt", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('favoritesList');
            list.innerHTML = "";
            snapshot.forEach((doc) => {
                const data = doc.data();
                const id = doc.id;
                const item = document.createElement('div');
                item.className = "flex items-center bg-gray-800/50 border border-gray-700 rounded px-2 py-1 max-w-[200px]";
                item.innerHTML = `
                    <button onclick="navigator.clipboard.writeText('${data.text.replace(/'/g, "\\'")}'); alert('Copiado!')" class="text-[9px] truncate text-gray-300 hover:text-white mr-2">${data.text}</button>
                    <button onclick="deleteFromGoogle('${id}')" class="text-red-500 hover:text-red-400 font-bold">√ó</button>
                `;
                list.appendChild(item);
            });
        });

        render(); updatePrompt();
    </script>
</body>
</html>
