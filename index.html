<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComfyUI Command Center - Male Art</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --bg: #030303; --card: #0a0a0a; --text: #e5e7eb; --border: #1a1a1a; --header: rgba(3, 3, 3, 0.9); }
        .light-theme { --bg: #f3f4f6; --card: #ffffff; --text: #1f2937; --border: #e5e7eb; --header: rgba(243, 244, 246, 0.9); }
        body { background-color: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: all 0.3s ease; }
        .btn-opt { background: var(--bg); border: 1px solid var(--border); transition: all 0.2s; cursor: pointer; font-size: 0.7rem; position: relative; color: var(--text); }
        .btn-opt.active { background: #4f46e5; border-color: #818cf8; color: white; box-shadow: 0 0 15px rgba(79, 70, 229, 0.3); }
        .btn-opt.weighted::after { content: '1.3'; position: absolute; top: -5px; right: -5px; background: #fbbf24; color: black; font-size: 0.5rem; padding: 1px 3px; border-radius: 4px; font-weight: bold; }
        .section-card { background: var(--card); border-radius: 12px; padding: 1rem; border: 1px solid var(--border); }
        .sticky-header { position: sticky; top: 0; z-index: 100; background: var(--header); backdrop-filter: blur(12px); padding: 1rem 0; border-bottom: 1px solid var(--border); }
        .lora-tag { color: #f472b6 !important; border-color: #f472b6 !important; }
    </style>
</head>
<body class="p-4 md:p-6">

    <div class="max-w-7xl mx-auto">
        <div class="sticky-header mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="bg-gray-950/20 p-4 rounded-xl border border-indigo-500/40">
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex gap-2">
                            <select id="modelSelect" onchange="updatePrompt()" class="bg-black/50 text-[10px] p-1.5 rounded border border-gray-700 text-indigo-400">
                                <option value="pony">PONY V6 (ComfyUI)</option>
                                <option value="xl">SDXL (ComfyUI)</option>
                            </select>
                            <select id="ratioSelect" onchange="updatePrompt()" class="bg-black/50 text-[10px] p-1.5 rounded border border-gray-700 text-green-400">
                                <option value="1024x1024">1:1 (1024x1024)</option>
                                <option value="832x1216">2:3 (832x1216)</option>
                                <option value="1216x832">3:2 (1216x832)</option>
                            </select>
                        </div>
                        <div class="flex gap-2 items-center">
                            <button onclick="toggleTheme()" class="text-lg px-1">üåì</button>
                            <button id="enhancerBtn" onclick="toggleEnhancer()" class="text-[9px] border border-gray-700 px-2 py-1 rounded font-bold uppercase">‚ú® Enhancer</button>
                            <button onclick="randomize()" class="text-[9px] bg-indigo-600 px-2 py-1 rounded font-bold uppercase">üé≤ Random</button>
                            <button onclick="saveToFavorites()" class="text-[9px] bg-green-800 px-2 py-1 rounded transition uppercase">‚≠ê Salvar</button>
                        </div>
                    </div>
                    <textarea id="output" class="w-full bg-black/40 text-xs h-24 p-2 border border-gray-800 rounded mb-2 font-mono" readonly></textarea>
                    <button onclick="copy('output')" class="w-full bg-indigo-600 text-[10px] font-black py-2.5 rounded uppercase tracking-widest">Copiar para ComfyUI</button>
                </div>

                <div class="bg-gray-950/20 p-4 rounded-xl border border-red-900/20">
                    <span class="text-[10px] font-bold text-red-500 block mb-1 uppercase">Negative Prompt</span>
                    <textarea id="negativeOutput" class="w-full bg-black/40 text-xs h-24 p-2 border border-gray-800 rounded mb-2 font-mono text-gray-500" readonly></textarea>
                    <button onclick="copy('negativeOutput')" class="w-full bg-red-900/40 text-[10px] font-bold py-2.5 rounded uppercase">Copiar Negativo</button>
                </div>
            </div>
            <div id="favoritesList" class="mt-4 flex flex-wrap gap-2 max-h-20 overflow-y-auto"></div>
        </div>

        <div id="builder" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // MANTENHA SEU CONFIG AQUI
        const firebaseConfig = {
            apiKey: "AIzaSyDDCA-De2_NIF5TWvMBOOLRRH2uvTN46Es",
            authDomain: "meugeradordeprompts.firebaseapp.com",
            projectId: "meugeradordeprompts",
            storageBucket: "meugeradordeprompts.firebasestorage.app",
            messagingSenderId: "301051793324",
            appId: "1:301051793324:web:1bbbd148b7e848e1397409"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const favsCollection = collection(db, "prompts");

        const categories = {
            "üß¨ LoRAs (Comfy)": ["<lora:add_detail:0.8>", "<lora:muscle_anatomy:0.7>", "<lora:male_genitalia_fix:1.0>", "<lora:skin_texture_pvc:0.6>"],
            "üë§ Rosto": ["sexy smile", "orgasm face", "intense gaze", "biting lip", "sweaty face", "heavy breathing", "blushing"],
            "üí™ F√≠sico": ["1man", "2men", "muscular hunk", "bear", "twink", "athletic", "hairy chest", "defined abs", "massive biceps", "thick thighs", "pre-cum"],
            "üçÜ Posi√ß√µes": ["missionary", "doggy style", "cowboy", "reverse cowboy", "oral sex", "rimming", "anal focus", "handjob", "frottage", "spooning", "spanking"],
            "üëî Look": ["jockstrap", "leather harness", "latex", "shiny pvc", "grey sweatpants", "white briefs", "suit", "towel", "thong", "nude"],
            "üì∏ Camera": ["full body", "close-up", "from below", "from above", "side view", "back view", "bokeh"],
            "üí° Luz": ["volumetric lighting", "rim lighting", "cinematic", "neon lights", "dramatic shadows", "golden hour"],
            "üìç Local": ["dark alley", "steamy shower", "gym locker", "leather bar", "sauna", "dungeon", "prison cell", "hotel room"]
        };

        let selectedTags = {}; 
        let categoryWeights = {};
        let lockedCategories = {};
        let enhancerEnabled = false;

        window.toggleTheme = () => document.body.classList.toggle('light-theme');
        window.toggleLock = (cat) => { lockedCategories[cat] = !lockedCategories[cat]; render(); };
        window.toggleEnhancer = () => { enhancerEnabled = !enhancerEnabled; document.getElementById('enhancerBtn').classList.toggle('enhancer-active'); updatePrompt(); };
        window.toggleTag = (tag) => { selectedTags[tag] = !selectedTags[tag]; updatePrompt(); render(); };
        window.toggleCategoryWeight = (cat) => { categoryWeights[cat] = !categoryWeights[cat]; updatePrompt(); render(); };
        window.clearAll = () => { selectedTags = {}; categoryWeights = {}; enhancerEnabled = false; updatePrompt(); render(); };
        window.copy = (id) => { const a = document.getElementById(id); a.select(); document.execCommand('copy'); alert("Copiado!"); };

        window.randomize = () => {
            Object.entries(categories).forEach(([cat, opts]) => {
                if (!lockedCategories[cat]) {
                    opts.forEach(o => delete selectedTags[o]);
                    if (Math.random() > 0.4) {
                        const r = opts[Math.floor(Math.random() * opts.length)];
                        selectedTags[r] = true;
                    }
                }
            });
            updatePrompt(); render();
        };

        function render() {
            const container = document.getElementById('builder');
            container.innerHTML = '';
            for (const [cat, options] of Object.entries(categories)) {
                const isLocked = lockedCategories[cat];
                const section = document.createElement('div');
                section.className = "section-card";
                section.innerHTML = `
                    <div class="flex justify-between items-center mb-3 border-b border-gray-800 pb-2">
                        <div class="flex items-center gap-2">
                            <button onclick="toggleLock('${cat}')" class="text-xs">${isLocked ? 'üîí' : 'üîì'}</button>
                            <h3 class="text-[9px] font-black text-indigo-400 uppercase">${cat}</h3>
                        </div>
                        <button onclick="toggleCategoryWeight('${cat}')" class="text-[8px] ${categoryWeights[cat] ? 'bg-yellow-600 text-black' : 'bg-gray-800 text-gray-500'} px-2 py-0.5 rounded">PESO+</button>
                    </div>
                `;
                const grid = document.createElement('div');
                grid.className = "grid grid-cols-2 gap-1.5";
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.innerText = opt;
                    const isSelected = selectedTags[opt];
                    const isLora = opt.includes('<lora');
                    btn.className = `btn-opt p-2 rounded text-left ${isSelected ? 'active' : ''} ${isSelected && categoryWeights[cat] ? 'weighted' : ''} ${isLora ? 'lora-tag' : ''}`;
                    btn.onclick = () => toggleTag(opt);
                    grid.appendChild(btn);
                });
                section.appendChild(grid);
                container.appendChild(section);
            }
        }

        function updatePrompt() {
            const model = document.getElementById('modelSelect').value;
            const ratio = document.getElementById('ratioSelect').value;
            let tags = [];
            let loras = [];

            for(const tag in selectedTags) {
                if(selectedTags[tag]) {
                    if(tag.includes('<lora')) loras.push(tag);
                    else {
                        // Encontra a categoria para checar peso
                        let cat = Object.keys(categories).find(c => categories[c].includes(tag));
                        tags.push(categoryWeights[cat] ? `(${tag}:1.3)` : tag);
                    }
                }
            }

            const enhancer = enhancerEnabled ? ", (skin texture:1.2), high detail, realistic lighting" : "";
            
            let pos = model === "pony" 
                ? `score_9, score_8, score_7, rating_explicit, ${tags.join(", ")}${enhancer} ${loras.join(" ")}`
                : `masterpiece, high quality, ${tags.join(", ")}${enhancer} ${loras.join(" ")}`;

            document.getElementById('output').value = `[Res: ${ratio}] \n` + pos;
            document.getElementById('negativeOutput').value = "female, woman, girl, low quality, bad anatomy, text, distorted";
        }

        onSnapshot(query(favsCollection, orderBy("createdAt", "desc")), (snap) => {
            const list = document.getElementById('favoritesList');
            list.innerHTML = "";
            snap.forEach((doc) => {
                const data = doc.data();
                const item = document.createElement('div');
                item.className = "flex items-center bg-gray-500/10 border border-gray-800 rounded px-2 py-1";
                item.innerHTML = `<button onclick="navigator.clipboard.writeText('${data.text.replace(/'/g, "\\'")}');" class="text-[8px] mr-2 max-w-[120px] truncate text-gray-500">${data.text}</button><button onclick="deleteFromGoogle('${doc.id}')" class="text-red-500 text-[10px]">√ó</button>`;
                list.appendChild(item);
            });
        });

        render(); updatePrompt();
    </script>
</body>
</html>
